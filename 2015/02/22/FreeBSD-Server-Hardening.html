<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>FreeBSD Server Hardening</title>
    <meta name="description" content="" />
    <link href="//fonts.googleapis.com/css?family=Noto+Sans:300,400,700" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="http://hemantthakur.github.io/themes/Saga/assets/css/style.css?v=1.0.0" rel="stylesheet" type="text/css">
    <link href="http://hemantthakur.github.io/themes/Saga/assets/css/animate.min.css?v=1.0.0" rel="stylesheet" type="text/css">
    <link href="http://hemantthakur.github.io/themes/Saga/favicon.ico" rel="shortcut icon">
    <link rel="canonical" href="http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html" />
    
    <meta property="og:site_name" content="Get Something Going" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="FreeBSD Server Hardening" />
    <meta property="og:description" content="After Installing clean FreeBSD Server, it is important to harden the server to enhancce the server security. In general “Hardening”  means making some changes on spongy material or surface so that it becomes more  stronger than before and harder to..." />
    <meta property="og:url" content="http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html" />
    <meta property="article:published_time" content="2015-02-21T18:30:00.000Z" />
    <meta property="article:modified_time" content="2015-03-08T15:03:05.030Z" />
    <meta property="article:tag" content="FreeBSD Server Hardening" />
    <meta property="article:tag" content="server hardening" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="FreeBSD Server Hardening" />
    <meta name="twitter:description" content="After Installing clean FreeBSD Server, it is important to harden the server to enhancce the server security. In general “Hardening”  means making some changes on spongy material or surface so that it becomes more  stronger than before and harder to..." />
    <meta name="twitter:url" content="http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Get Something Going",
    "author": {
        "@type": "Person",
        "name": "",
        "image": "https://avatars.githubusercontent.com/u/6284495?v=3",
        "url": "undefined/author/undefined",
        "sameAs": "http://iamhemant.in"
    },
    "headline": "FreeBSD Server Hardening",
    "url": "http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html",
    "datePublished": "2015-02-21T18:30:00.000Z",
    "dateModified": "2015-03-08T15:03:05.030Z",
    "keywords": "FreeBSD Server Hardening,  server hardening",
    "description": "After Installing clean FreeBSD Server, it is important to harden the server to enhancce the server security. In general “Hardening”  means making some changes on spongy material or surface so that it becomes more  stronger than before and harder to..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="Get Something Going" href="http://hemantthakur.github.io/rss" />
</head>
<body class="post-template tag-undefined tag-undefined">
    <header id="header" class="animated fadeIn">
    <div class="header-background">
    <section class="blog-content">
        <a id="site-url" class="blog-title" href="http://hemantthakur.github.io">Get Something Going</a>
        <span class="blog-description">Tell me and I forget, teach me and I may remember, involve me and I learn.</span>
        <nav class="links fadeIn animated">
            <ul>
                <!-- <li class="rss"><a title="RSS Feed" href="/rss/"><i class="fa fa-fw fa-rss-square"></i></a></li> -->
        
            </ul>
        </nav>
    </section>
    <section class="header-content">
        <h1 class="post-title animated fadeInUp">FreeBSD Server Hardening</h1>
        <span class="post-data"><span class="date animated fadeInUp"><i class="fa fa-clock-o"></i> <time class="timesince date" data-timesince="1424543400" datetime="2015-02-22T00:00" title="22 February 2015">15 days ago</time></span>
            <span class="tags animated fadeInUp"><i class="fa fa-tags"></i> <a href="http://hemantthakur.github.io/tag/FreeBSD Server Hardening">FreeBSD Server Hardening</a>, <a href="http://hemantthakur.github.io/tag/ server hardening"> server hardening</a></span>
            <span class="author animated fadeInUp"><i class="fa fa-user"></i> <a href=""></a></span></span>
    </section>
    </div>
</header>
<main id="main" class="content">
    <article itemtype="http://schema.org/BlogPosting" class="animated fadeIn content post post tag-undefined tag-undefined">
        <section class="post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>After Installing clean FreeBSD Server, it is important to harden the server to enhancce the server security.
In general “Hardening”  means making some changes on spongy material or surface so that it becomes more  stronger than before and harder to disfigurement. Similarly, Hardened servers are more resistant to security issue than the non-hardened servers.
Nowadays everything is online and there are a lot of attacks on servers, so server hardening is an absolute must.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_requirements">Requirements:</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clean FreeBSD Server.</p>
</li>
<li>
<p>SSH client.</p>
</li>
<li>
<p>Text editor.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_hardening_steps">Hardening steps:</h4>
<div class="sect4">
<h5 id="_disable_local_root_access">Disable Local root Access</h5>
<div class="paragraph">
<p>The first rule to secure the server is, never treat the root account as a regular user.Always log as a normal user and su to root only when needed.</p>
</div>
<div class="paragraph">
<p>To prevent Root from directly logging onto your system.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Open “/etc/ttys”  and change every occurence of “secure” to “insecure”.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_filesystem_structure">Filesystem Structure:</h5>
<div class="paragraph">
<p>when we install the default FreeBSD server then the “tmp” directory is at two places - “/tmp” and “/var/tmp”.  Delete “/var/tmp” and Create link from “/var/tmp” to “/tmp”.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># mv /var/tmp/* /tmp/
# rm -rf /var/tmp
# ln -s /tmp /var/tmp</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ssh_logins">SSH Logins</h5>
<div class="paragraph">
<p>By default, FreeBSD prevents root from logging  via ssh, but it gives  access to anyone  with a valid user account.</p>
</div>
<div class="paragraph">
<p>Ensure only sshv2 is used for connection purpose. SSHV1 does not provide all the security.Open /etc/ssh/sshd_config.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>uncomment the line “Protocol 2” and also uncomment all the hostkeys for protocol version 2.</pre>
</div>
</div>
<div class="paragraph">
<p>Ensure server is not running X11. Turn off forwarding for X11.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Again open /etc/ssh/sshd_config file search for “X11Forwarding yes”  by default it is commented and default value is “yes”, uncomment the line and change value  to “no”.</pre>
</div>
</div>
<div class="paragraph">
<p>Disable OS Display.</p>
</div>
</div>
<div class="sect4">
<h5 id="_restriction_on_user_access">Restriction on user Access:</h5>
<div class="paragraph">
<p>The basic rule of the server security is “Restric the read/write and execution of certain files”. Update restricitions of some files. Hit these commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># chmod o= /etc/sysctl.conf
# chmod o= /etc/ttys
# chmod o= /etc/inetd.conf
# chmod o= /etc/login.*
# chmod o= /etc/fstab
# chmod o= /etc/rc.conf
# chmod o= /etc/ftpusers
# chmod o= /etc/group
# chmod o= /etc/host*
# chmod o= /etc/inetd.conf
# chmod o= /usr/bin/users
# chmod o= /usr/bin/w
# chmod o= /usr/bin/who
# chmod o= /usr/bin/lastcomm
# chmod o= /usr/bin/lastlogin
# chmod o= /usr/bin/last</pre>
</div>
</div>
<div class="paragraph">
<p>Attackers tend to clear out all log files when they are finished with the server attack. So change the log file permission so that later you can check what was done.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># chmod o= /var/log
# chflags sappnd /var/log
# chflags sappnd /var/log/*</pre>
</div>
</div>
<div class="paragraph">
<p>by applying these changes, logs can no longer be rotated.</p>
</div>
</div>
<div class="sect4">
<h5 id="_password_rules">Password Rules</h5>
<div class="paragraph">
<p>By default, FreeBSD uses md5 for password hashing and encryption. But blowfish is much better and secure for passwords.
Open /etc/login.conf and make some chages:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; change the password format in the default class to blf.
&gt; Use some password policy like minimum password length and mix upper and lower case.
&gt; Policy to change the password after some days.
&gt; Automatically logout the user if they are idle for specific time.
&gt; Prevent global access by setting the default umask.</pre>
</div>
</div>
<div class="paragraph">
<p>Update the login database:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># cap_mkdb /etc/login.conf</pre>
</div>
</div>
<div class="paragraph">
<p>Here is my /etc/login.conf file snapshot.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Password will be converted to blowfish after changing the password. Check /etc/master.passwd after changing the password, if hashing with password begins with $2 it means blowfish is being used</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_disable_some_services">Disable Some services:</h5>
<div class="paragraph">
<p>Open /etc/rc.conf  and add following lines:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sendmail_enable="NONE" #Disable sendmail as it insecure MTA.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>kern_securelevel_enable="YES"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>kern_securelevel="3" #The default kernel level is -1, means not much secure. Use level 2 or 3, 3 is the more secure level.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>inetd_enable="NO" # inetd, or the network daemon dispatcher, is insecure so we want to make sure it is disabled.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>clear_tmp_enable="YES" #By default in FreeBSD the /tmp directory does not get empty on startup its better to clear /tmp directory at the startup so that there is nothing malicious hanging in temp files.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>syslogd_flags="-ss"  # Ensure  syslogd doesn't bind to a network socket if remote logging is not enabled.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>icmp_drop_redirect="YES"
icmp_log_redirect="YES"  #ICMP Redirect messages can be used by attackers to lead you to their router or some other router. Ignore those packets and log them.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_kernel_states">Kernel States</h5>
<div class="paragraph">
<p>Change some kernel states and to make permanent open /etc/sysctl.conf  file and add the following lines.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>security.bsd.see_other_uids=0   #prevent users from seeing information about processes that are being run under another UID.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>net.inet.tcp.blackhole=2
net.inet.udp.blackhole=1 #these two lines enable the concept of blackholing. This is so RST packets don’t get sent back in response to closed ports. This helps to block port scans.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>net.inet.ip.random_id=1 # generate a random ID for the IP packets. This will prevent remote observers from determining the rate packets are being generated by watching the counter.</pre>
</div>
</div>
<div class="paragraph">
<p>These are the server hardening steps to secure your production server.</p>
</div>
</div>
</div>
        </section>

    </article>

</main>
    <footer class="animated fadeIn" id="footer">
        <section class="colophon">
          <section class="copyright">Copyright &copy; <span itemprop="copyrightHolder">Get Something Going</span>. <span rel="license">All Rights Reserved</span>.</section>
          <section class="poweredby">Published with <a class="icon-ghost" href="http://hubpress.io">HubPress</a></section>
        </section>
        <section class="bottom">
          <section class="attribution">
            <a href="http://github.com/Reedyn/Saga">Built with <i class="fa fa-heart"></i> and Free and Open-Source Software</a>.
          </section>
        </section>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script>
    <script src="http://hemantthakur.github.io/themes/Saga/assets/js/scripts.js?v=1.0.0"></script>
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-60499968-1', 'auto');
    ga('send', 'pageview');

    </script>
</body>
</html>
