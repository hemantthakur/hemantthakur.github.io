<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>FreeBSD Server Hardening</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://hemantthakur.github.io/themes/Casper/favicon.ico">

    <link rel="stylesheet" type="text/css" href="http://hemantthakur.github.io/themes/Casper/assets/css/screen.css?v=1.0.0" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <link rel="canonical" href="http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html" />
    
    <meta property="og:site_name" content="Get Something Going" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="FreeBSD Server Hardening" />
    <meta property="og:description" content="After Installing clean FreeBSD Server, it is important to harden the server to enhancce the server security. In general “Hardening”  means making some changes on spongy material or surface so that it becomes more  stronger than before and harder to..." />
    <meta property="og:url" content="http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html" />
    <meta property="article:published_time" content="2015-02-21T18:30:00.000Z" />
    <meta property="article:modified_time" content="2015-02-22T15:19:08.100Z" />
    <meta property="article:tag" content="FreeBSD Server Hardening" />
    <meta property="article:tag" content="server hardening" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="FreeBSD Server Hardening" />
    <meta name="twitter:description" content="After Installing clean FreeBSD Server, it is important to harden the server to enhancce the server security. In general “Hardening”  means making some changes on spongy material or surface so that it becomes more  stronger than before and harder to..." />
    <meta name="twitter:url" content="http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Get Something Going",
    "author": {
        "@type": "Person",
        "name": "",
        "image": "https://avatars.githubusercontent.com/u/6284495?v=3",
        "url": "undefined/author/undefined",
        "sameAs": "http://iamhemant.in"
    },
    "headline": "FreeBSD Server Hardening",
    "url": "http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html",
    "datePublished": "2015-02-21T18:30:00.000Z",
    "dateModified": "2015-02-22T15:19:08.100Z",
    "keywords": "FreeBSD Server Hardening,  server hardening",
    "description": "After Installing clean FreeBSD Server, it is important to harden the server to enhancce the server security. In general “Hardening”  means making some changes on spongy material or surface so that it becomes more  stronger than before and harder to..."
}
    </script>

    <meta name="generator" content="Ghost ?" />
    <link rel="alternate" type="application/rss+xml" title="Get Something Going" href="http://hemantthakur.github.io/rss" />
</head>
<body class="post-template tag-undefined tag-undefined">

    


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="back-button icon-arrow-left" href="http://hemantthakur.github.io">Home</a>
        <a class="subscribe-button icon-feed" href="http://hemantthakur.github.io/rss/">Subscribe</a>
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-undefined tag-undefined">

        <header class="post-header">
            <h1 class="post-title">FreeBSD Server Hardening</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2015-02-22">22 February 2015</time>  on <a href="http://hemantthakur.github.io/tag/FreeBSD Server Hardening">FreeBSD Server Hardening</a>, <a href="http://hemantthakur.github.io/tag/ server hardening"> server hardening</a>
            </section>
        </header>

        <section class="post-content">
            <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>After Installing clean FreeBSD Server, it is important to harden the server to enhancce the server security.
In general “Hardening”  means making some changes on spongy material or surface so that it becomes more  stronger than before and harder to disfigurement. Similarly, Hardened servers are more resistant to security issue than the non-hardened servers.
Nowadays everything is online and there are a lot of attacks on servers, so server hardening is an absolute must.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_requirements">Requirements:</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clean FreeBSD Server.</p>
</li>
<li>
<p>SSH client.</p>
</li>
<li>
<p>Text editor (I prefer vi).</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_hardening">Hardening</h4>
<div class="sect4">
<h5 id="_disable_local_root_access">Disable Local root Access</h5>
<div class="paragraph">
<p>The first rule to secure the server is, never treat the root account as a regular user.  Always log as a   normal user and su to root only when needed. To prevent Root from directly logging onto your system.
Open “/etc/ttys”  and change every occurence of “secure” to “insecure”.</p>
</div>
<div class="paragraph">
<p>image::https://github.com/hemantthakur/hemantthakur.github.io/tree/master/images/ttybefore.png</p>
</div>
<div class="paragraph">
<p>/etc/ttys file screenshot before modification</p>
</div>
<div class="paragraph">
<p>/etc/ttys file after modification</p>
</div>
<div class="paragraph">
<p>Filesystem Structure:
   when we install the default FreeBSD server then the “tmp” directory is at two places - “/tmp” and “/var/tmp”.  Delete “/var/tmp” and Create link from “/var/tmp” to “/tmp”.</p>
</div>
</div>
</div>
<h1 id="_mv_var_tmp_tmp" class="sect0">mv /var/tmp/* /tmp/</h1>

<h1 id="_rm_rf_var_tmp" class="sect0">rm -rf /var/tmp</h1>

<h1 id="_ln_s_tmp_var_tmp" class="sect0">ln -s /tmp /var/tmp</h1>
<div class="paragraph">
<p>SSH Logins</p>
</div>
<div class="paragraph">
<p>By default, FreeBSD prevents root from logging  via ssh, but it gives  access to anyone  with a valid user account.
Ensure only sshv2 is used for connection purpose. SSHV1 does not provide all the security.
Open /etc/ssh/sshd_config . uncomment the line “Protocol 2” and also uncomment all the hostkeys for protocol version 2.
Ensure server is not running X11. Turn off forwarding for X11.
Open /etc/ssh/sshd_config file search for “X11Forwarding yes”  by default it is commented and default value is “yes”, uncomment the line and change value  to “no”
Disable OS Display.</p>
</div>
<div class="paragraph">
<p>Restriction on user Access:</p>
</div>
<div class="paragraph">
<p>The basic rule of the server security is “Restric the read/write and execution of certain files”. Update restricitions of some files. Hit these commands:
  	# chmod o= /etc/sysctl.conf
# chmod o= /etc/ttys
# chmod o= /etc/inetd.conf
# chmod o= /etc/login.*
# chmod o= /etc/fstab
# chmod o= /etc/rc.conf
# chmod o= /etc/ftpusers
# chmod o= /etc/group
# chmod o= /etc/host*
# chmod o= /etc/inetd.conf
#chmod o= /usr/bin/users
#chmod o= /usr/bin/w
#chmod o= /usr/bin/who
#chmod o= /usr/bin/lastcomm
#chmod o= /usr/bin/lastlogin
#chmod o= /usr/bin/last</p>
</div>
<div class="paragraph">
<p>Attackers tend to clear out all log files when they are finished with the server attack. So change the log file permission so that later you can check what was done.
# chmod o= /var/log
# chflags sappnd /var/log
# chflags sappnd /var/log/*
by applying these changes, logs can no longer be rotated.</p>
</div>
<div class="paragraph">
<p>Password Rules</p>
</div>
<div class="paragraph">
<p>By default, FreeBSD uses md5 for password hashing and encryption. But blowfish is much better and secure for passwords.
Open /etc/login.conf and make some chages:
change the password format in the default class to blf.
Use some password policy like minimum password length and mix upper and lower case.
Policy to change the password after some days.
Automatically logout the user if they are idle for specific time.
Prevent global access by setting the default umask.</p>
</div>
<div class="paragraph">
<p>Update the login database:
	# cap_mkdb /etc/login.conf</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Here is my /etc/login.conf file snapshot.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Password will be converted to blowfish after changing the password. Check /etc/master.passwd after changing the password, if hashing with password begins with $2 it means blowfish is being used</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Disable Some services:</p>
</div>
<div class="paragraph">
<p>Disable sendmail as it insecure MTA.
Open /etc/rc.conf  and add line sendmail_enable="NONE".
 The default kernel level is -1, means not much secure. Use level 2 or 3, 3 is the more secure level
Open /etc/rc.conf  and add line kern_securelevel_enable="YES" and kern_securelevel="3" .
inetd, or the network daemon dispatcher, is insecure so we want to make sure it is disabled.
Open /etc/rc.conf  and add line inetd_enable="NO".
By default in FreeBSD the /tmp directory does not get empty on startup its better to clear /tmp directory at the startup so that there is nothing malicious hanging in temp files.
Open /etc/rc.conf  and add line clear_tmp_enable="YES"
Ensure  syslogd doesn;t bind to a network socket if remote logging is not enabled.
Open /etc/rc.conf and add line syslogd_flags="-ss".
ICMP Redirect messages can be used by attackers to lead you to their router or some other router. Ignore those packets and log them.
Open /etc/rc.conf and add lines icmp_drop_redirect="YES"  and icmp_log_redirect="YES" .
Kernel States
Change some kernel states and to make permanent open /etc/sysctl.conf  file and add the following lines.</p>
</div>
<div class="paragraph">
<p>security.bsd.see_other_uids=0   #prevent users from seeing information about processes that are being run under another UID.
net.inet.tcp.blackhole=2
net.inet.udp.blackhole=1 #these two lines enable the concept of blackholing. This is so RST packets don’t get sent back in response to closed ports. This helps to block port scans.
net.inet.ip.random_id=1     # generate a random ID for the IP packets . This will prevent remote observers from determining the rate packets are being generated by watching the counter.</p>
</div>
<div class="paragraph">
<p>These are the server hardening steps to secure your production server.</p>
</div>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="" style="background-image: url(https://avatars.githubusercontent.com/u/6284495?v=3)"><span class="hidden">'s Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href=""></a></h4>

                    <p>Read <a href="">more posts</a> by this author.</p>
                <div class="author-meta">
                    <span class="author-location icon-location">Chandigarh</span>
                    <span class="author-link icon-link"><a href="http://iamhemant.in">http://iamhemant.in</a></span>
                </div>
            </section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=FreeBSD%20Server%20Hardening&amp;url=http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://hemantthakur.github.io/2015/02/22/FreeBSD-Server-Hardening.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


    </article>

</main>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="http://hemantthakur.github.io">Get Something Going</a> &copy; 2015</section>
        <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</a></section>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script>

    <script type="text/javascript" src="http://hemantthakur.github.io/themes/Casper/assets/js/jquery.fitvids.js?v=1.0.0"></script>
    <script type="text/javascript" src="http://hemantthakur.github.io/themes/Casper/assets/js/index.js?v=1.0.0"></script>

</body>
</html>
